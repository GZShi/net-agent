webpackJsonp([1],{"/Gj8":function(e,t){},"40o8":function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("+RKF"),s={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var a=n("C7Lr")({name:"App"},s,!1,function(e){n("w7YO")},null,null).exports,o=n("IhWa"),i={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"hello"},[n("h1",[e._v(e._s(e.msg))]),e._v(" "),n("h2",[e._v("Essential Links")]),e._v(" "),n("h2",[e._v("Ecosystem")]),e._v(" "),n("router-link",{attrs:{to:"/chat-panel"}},[e._v("沟通工具")])],1)},staticRenderFns:[]};var c=n("C7Lr")({name:"HelloWorld",data:function(){return{msg:"Welcome to Your Vue.js App"}}},i,!1,function(e){n("XwPQ")},"data-v-40fdb161",null).exports,u=n("IHPB"),l=n.n(u),p=n("ZLEe"),f=n.n(p),d=n("lC5x"),v=n.n(d),h=n("J0Oq"),m=n.n(h),g=n("MgeX"),b=n.n(g),x=n("3cXf"),_=n.n(x);n("rVsN");function w(e){return f()(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}var C,k,y,E,I={},L=(C=m()(v.a.mark(function e(t,n){var r,s,a,o,i,c,u,l,p;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(200==t.status){e.next=2;break}throw"http_error::"+t.statusText+"("+t.status+")\n"+n;case 2:return r=void 0,e.prev=3,e.next=6,t.json();case 6:r=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(3),"parse body as json failed";case 12:if(!("ErrCode"in r)){e.next=19;break}if(a=(s=r).ErrCode,o=s.ErrMsg,i=s.Data,0==a){e.next=16;break}throw o||"normal_error::"+a;case 16:return e.abrupt("return",i);case 19:if(!("errcode"in r)){e.next=24;break}if(u=(c=r).errcode,l=c.errmsg,p=c.data,0==u){e.next=23;break}throw l||"normal_error::"+u;case 23:return e.abrupt("return",p);case 24:throw"unknown error code";case 25:case"end":return e.stop()}},e,this,[[3,9]])})),function(e,t){return C.apply(this,arguments)}),D=(k=m()(v.a.mark(function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t+"?"+w(r),{credentials:"same-origin",headers:I});case 2:return n=e.sent,e.abrupt("return",L(n,t));case 4:case"end":return e.stop()}},e,this)})),function(e){return k.apply(this,arguments)}),T=(y=m()(v.a.mark(function e(t,n){var r,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t+"?"+w(s),{method:"POST",body:_()(n),credentials:"same-origin",headers:I});case 2:return r=e.sent,e.abrupt("return",L(r,t));case 4:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)}),V=(E=m()(v.a.mark(function e(t,n){var r,s,a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=w(o))&&(t=t+"?"+r),s=new FormData,f()(n).forEach(function(e){s.append(e,n[e])}),e.next=6,fetch(t,{method:"POST",body:s});case 6:return a=e.sent,e.abrupt("return",L(a,t));case 8:case"end":return e.stop()}},e,this)})),function(){var e=m()(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D("/agent-api/ctx-info"));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()),$=function(){var e=m()(v.a.mark(function e(t,n,r){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",T("/agent-api/new-message",{groupID:t,msgType:n,message:r}));case 1:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}(),P=function(){var e=m()(v.a.mark(function e(){var t,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T("/agent-api/recent-message",{});case 2:return t=e.sent,n={},t.forEach(function(e){n[e.groupID]||(n[e.groupID]={id:e.groupID,msgs:[]}),n[e.groupID].msgs.push(e)}),e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),R={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"group-list-container"},[t("div",{staticStyle:{padding:"1em","font-style":"italic",color:"gray"}},[this._v("Group list is comming soon")])])}]},F=n("C7Lr")(null,R,!1,null,null,null).exports,G={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"bubble-container",class:{right:e.isSelf,min:!0}},[n("div",{staticClass:"meta-info"},[e._v(e._s(e.info))]),e._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"bubble"},[e._v(e._s(e.content))])])])},staticRenderFns:[]};var S={components:{Bubble:n("C7Lr")({props:["isSelf","info","content"]},G,!1,function(e){n("ogkP")},"data-v-569e21d3",null).exports},props:["messages","myVhost"],watch:{messages:function(){var e=this;this.messages&&this.messages.length>0&&setTimeout(function(){e.$refs.bubbles[e.$refs.bubbles.length-1].$el.scrollIntoView()},5)}}},M={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"bubble-board-container"},[n("div",{staticClass:"header-bar"},[e._v("沟通大厅（212）")]),e._v(" "),n("div",{staticClass:"content-bar"},e._l(e.messages,function(t,r){return n("Bubble",{key:r,ref:"bubbles",refInFor:!0,attrs:{"is-self":t.sender==e.myVhost,info:t.sender,content:t.content}})}),1)])},staticRenderFns:[]};var O={data:function(){return{textareaValue:"",sendErrorInfo:""}},methods:{sendGroupMessage:function(){var e=this;return m()(v.a.mark(function t(){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!/^[\s ]*$/.test(e.textareaValue)){t.next=3;break}return e.setErrInfo("内容不能为空"),t.abrupt("return");case 3:return t.prev=3,t.next=6,$(0,0,e.textareaValue);case 6:e.textareaValue="",t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(3),e.setErrInfo("发送失败："+t.t0),t.abrupt("return");case 13:case"end":return t.stop()}},t,e,[[3,9]])}))()},setErrInfo:function(e){var t=this;this.sendErrorInfo=e,setTimeout(function(){return t.sendErrorInfo=""},2e3)}}},j={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"input-panel-container"},[n("div",{staticClass:"tools-bar"},[e._v("Text message input area: ")]),e._v(" "),n("div",{staticClass:"input-area"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.textareaValue,expression:"textareaValue"}],domProps:{value:e.textareaValue},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.sendGroupMessage(t):null},input:function(t){t.target.composing||(e.textareaValue=t.target.value)}}})]),e._v(" "),n("div",{staticClass:"bottom-actions"},[e._m(0),e._v(" "),n("div",{staticClass:"right"},[n("span",{staticClass:"error-info"},[e._v(e._s(e.sendErrorInfo))]),e._v(" "),n("button",{on:{click:e.sendGroupMessage}},[e._v("发送")])])])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"left"},[t("span",[this._v("使用Ctrl+Enter发送")])])}]};var B={components:{GroupList:F,TalkContentBoard:n("C7Lr")(S,M,!1,function(e){n("40o8")},"data-v-2dd57f5c",null).exports,InputPanel:n("C7Lr")(O,j,!1,function(e){n("gD4t")},"data-v-4d32a8e4",null).exports},data:function(){return{groups:{0:{id:0,info:{label:"沟通大厅"},messages:[]}},activeGroupID:0,ctx:{},chatws:null}},computed:{groupList:function(){return b()(this.groups)},group:function(){return this.groups[""+this.activeGroupID]},messages:function(){var e=this.group.messages;return e.length<300?e:e.slice(e.length-300)}},mounted:function(){this.loadCtxInfo(),this.connectChatServer(),this.loadRecentMessages()},methods:{loadCtxInfo:function(){var e=this;return m()(v.a.mark(function t(){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,V();case 2:e.ctx=t.sent;case 3:case"end":return t.stop()}},t,e)}))()},loadRecentMessages:function(){var e=this;return m()(v.a.mark(function t(){var n;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P();case 2:n=t.sent,console.log("group msg map",n),f()(n).map(function(t){var r;(r=e.groups[t].messages).push.apply(r,l()(n[t].msgs))});case 5:case"end":return t.stop()}},t,e)}))()},connectChatServer:function(){var e=this;return m()(v.a.mark(function t(){var n;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null===e.chatws){t.next=2;break}return t.abrupt("return");case 2:n=new WebSocket("ws://localhost:2021/ws-conn"),e.chatws=n,n.onopen=function(){console.log("ws connected")},n.onerror=function(e){console.log("ws onerror",e)},n.onmessage=function(t){var n=t.type,r=t.data;console.log("ws onmessage",n,r);var s=JSON.parse(r),a=s.senderType,o=s.sender,i=s.groupID,c=s.message,u=s.msgType,l=e.groups[""+i];l?l.messages.push({content:c,date:"",groupID:i,id:0,sender:o,senderType:a,type:u}):console.log("group not found",i)};case 7:case"end":return t.stop()}},t,e)}))()}}},N={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"chat-panel-container"},[t("div",{staticClass:"left-group-list"},[t("GroupList",{attrs:{"group-list":this.groupList}})],1),this._v(" "),t("div",{staticClass:"right-chat-board"},[t("div",{staticClass:"top-bubble"},[t("TalkContentBoard",{attrs:{messages:this.group.messages,"my-vhost":this.ctx.vhost}})],1),this._v(" "),t("div",{staticClass:"bottom-input"},[t("InputPanel")],1)])])},staticRenderFns:[]};var A=n("C7Lr")(B,N,!1,function(e){n("/Gj8")},"data-v-53ee01d3",null).exports;r.a.use(o.a);var H=new o.a({routes:[{path:"/chat-panel",name:"ChatPanel",component:A},{path:"/",name:"Login",component:c}]});r.a.config.productionTip=!1,new r.a({el:"#app",router:H,components:{App:a},template:"<App/>"})},XwPQ:function(e,t){},gD4t:function(e,t){},ogkP:function(e,t){},w7YO:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.293c9b23c53b6ca66157.js.map